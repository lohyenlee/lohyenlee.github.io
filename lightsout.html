<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    canvas {
      border: 1px solid #d3d3d3;
      background-color: #303030;
    }
  </style>
</head>

<body onload="init()">

  <script>
    const xmax = 4, ymax = 3, imax = xmax * ymax;
    const a = 50, b = 2;
    var state = new Array(imax);
    var canvas, ctx;

    function init() {
      //-------- Scramble to get initial state
      for (i = 0; i < imax; ++i) state[i] = 0;
      for (x = 0; x < xmax; ++x) {
        for (y = 0; y < ymax; ++y) {
          if (Math.random() > 0.5) toggle(x, y);
        }
      }

      //-------- SET UP GUI
      canvas = document.createElement("canvas");
      canvas.width = xmax * a;
      canvas.height = ymax * a;
      ctx = canvas.getContext("2d");
      document.body.insertBefore(canvas, document.body.childNodes[0]);
      canvas.addEventListener("mousedown", doMouseDown, false);
      updateCanvas();
    }

    function updateCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.strokeStyle = "white";
      ctx.fillStyle = "yellow";
      for (x = 0; x < xmax; ++x) {
        for (y = 0; y < ymax; ++y) {
          i = x + xmax * y;
          ctx.strokeRect(x * a, y * a, a, a);
          if (state[i])
            ctx.fillRect(x * a + b, y * a + b, a - b - b, a - b - b);
        }
      }
    }

    function toggle(x, y) {
      if (x >= 0 && x < xmax && y >= 0 && y < ymax) {
        i = x + xmax * y;
        state[i] = 1 - state[i];
      }
    }
    function win() {
      var sum = 0;
      for (i = 0; i < imax; ++i) sum += state[i];
      return (sum == 0);
    }

    function doMouseDown(event) {
      x = event.pageX;
      y = event.pageY;
      x = Math.floor(x / a);
      y = Math.floor(y / a);
      if (x >= 0 && x < xmax && y >= 0 && y < ymax) {
        toggle(x, y);
        toggle(x + 1, y);
        toggle(x - 1, y);
        toggle(x, y + 1);
        toggle(x, y - 1);
      }
      updateCanvas();


      if (win()) alert("Congratulations!  You won!");
    }
  </script>

  <div>
    <p> Click each square to toggle it and its neighbors. Try to turn all the lights out! </p>
  </div>

</body>

</html>