<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@700&display=swap" rel="stylesheet">
  <style>    
    body {
        font-family:'Titillium Web',sans-serif;
        background-color:#333; color:#CCC;
    }
    h1 {color:white;}
    h2 {
        background-image:url('happy1.webp');background-size:contain;background-repeat: no-repeat;background-position:0px;
        padding:0 0 0 48px; color:#fff;
    }
    .table {width: 15em; margin-left: 3em;}
    .cell1 {width: 10em; display:inline-block; float:left;}
    .cell2 {width: 5em; display:inline-block; clear:both; font-family:monospace;} 
     /* min-width: 10em; margin-left: 2em;} */
     /* min-width: 20em; margin-left: 2em;} */

  </style>
</head>
<body>


<h1>Toad Burn</h1>
<p>By Yen Lee Loh and Isaac Hutchison (November 2025) </p>

<!-- ############################ -->
<h2>Summary</h2>

<p>Toad Burn is an educational browser-based puzzle game that aims to introduce digital logic and sequential logic in a fun way. </p>

<!-- ############################ -->
<h2>Gameplay</h2>
<p>Toad Burn consists of a series of levels.  
Each level takes the form of a finite grid of squares (cells).
The player (Mario) can walk East, West, North, or South.  
Walking into a P Switch toggles it between OFF and ON states.
The objective of each level is to defeat the enemy (Bowser) by flooding his square with lava.
Mario is not able to attack Bowser directly.  
Instead, he must use logic and ingenuity to channel lava into Bowser's square.
Mario must also avoid flooding Princess Peach with lava!  
If Peach gets burned, the level is lost and must be restarted.
</p>

<p>Toad Logic plays a central role in the game.
A cell may be occupied by a toad.
If the cells to the north, south, and west are lava-free, the toad is happy (ON) and spews lava toward the east.
If any of the three cells to the north, south, and west have lava, 
the toad is crying (OFF) and emits no lava.
</p>

<p>Depending on how many input cells (N, S, or W) are active, 
    a toad corresponds to a NOT, NOR, or 3-way NOR gate in digital electronics.
</p>

<p>Ordinarily, lava can spread in all directions.  
If a cell has 3 or 4 neighbors, it functions as a splitter or merge point.
However, <em>grade separation</em> can be enabled on a cell by toggling on a subway.
Then, the lava flow along ground level in the East-West direction
and the flow along the subway level in the North-South directions
do not mix.
This allows the level designer to route wires across each other without signal interference.
This is necessary for creating complex circuits.
</p>


<p>Stars are the equivalent of lamps or LEDs in electronics.
They merely indicate ON/OFF state at key points in the circuit, with no impact on circuit behavior or gameplay.
</p>



<!-- ############################ -->
<h2>Controls</h2>
<p> Default keybindings are as follows.</p>
<div class="table">
<!-- <div class="cell1">Go north </div><div class="cell2">&#8593; or E </div>
<div class="cell1">Go south </div><div class="cell2">&#8595; or D </div>
<div class="cell1">Go west </div><div class="cell2">&#8592; or J </div>
<div class="cell1">Go east </div><div class="cell2">&#8594; or L </div> -->
<div class="cell1">Go north </div><div class="cell2"> E </div>
<div class="cell1">Go south </div><div class="cell2"> D </div>
<div class="cell1">Go west  </div><div class="cell2"> S </div>
<div class="cell1">Go east  </div><div class="cell2"> F </div>
<div class="cell1">Reset level </div><div class="cell2">Shift-R </div>
<div class="cell1">Go to previous level </div><div class="cell2"> [ </div>
<div class="cell1">Go to next level     </div><div class="cell2"> ] </div>
<div class="cell1">Enter cheat mode     </div><div class="cell2"> Shift-C </div>
</div>
<p> In cheat mode (or sandbox mode), additional abilities are available: </p>
<div class="table">
<div class="cell1">Place lava     </div><div class="cell2"> H </div>
<div class="cell1">Place trench   </div><div class="cell2"> J </div>
<div class="cell1">Toggle subway  </div><div class="cell2"> K </div>
<div class="cell1">Place toad     </div><div class="cell2"> L </div>
<div class="cell1">Place grass    </div><div class="cell2"> ; </div>
</div>


<h2>Implementation</h2>
<p>
The circuit dynamics is modeled as a finite-state cellular automaton.
The state of each cell depends only on the states of five cells (Center, East, West, North, and South) at the previous timestep.
The state of a cell has several possible values:
<div class="table">
    <div class="cell1">Empty </div><div class="cell2">0</div>
    <div class="cell1">Cold, contagious </div><div class="cell2">1</div>
    <div class="cell1">Cold, recovering </div><div class="cell2">2</div>
    <div class="cell1">Cold, dormant    </div><div class="cell2">3</div>
    <div class="cell1">Hot, contagious  </div><div class="cell2">7</div>
    <div class="cell1">Hot, recovering  </div><div class="cell2">6</div>
    <div class="cell1">Hot, dormant     </div><div class="cell2">5</div>
    <div class="cell1">Toad, crying     </div><div class="cell2">4</div>
    <div class="cell1">Toad, happy      </div><div class="cell2">8</div>
</div>
</p>
Imagine that there are two kinds of viruses, hot and cold.  
If a cell is contagious, on the next timestep it will enter recovery.
If a cell is recovering, it cannot be re-infected, and on the next timestep the virus will become dormant 
(although the cell is still a carrier of that type of virus).
If a cell is dormant, it can be infected by EITHER type of virus if an adjacent cell is contagious.
These rules allow unidirectional pulse propagation in either direction along a row of cells.
See ToadBurnDetails.txt for more info.
</p>
<p>
Recall that a toad emits lava only if there is no incoming lava.  
This is equivalent to a NOR gate.
If all inputs are OFF, then the output is ON.  
If any input is ON, then the output is OFF. 
</p>
<p>
More implementation details are below.
</p>

<pre>
========================================
LOGIC CIRCUIT CELLULAR AUTOMATON
========================================

Consider a 2D grid with cells labeled by coordinates x=0,...,X-1 and y=0,...,Y-1.
Each cell has a state V(x,y).
At every timestep, update all sites according to a 5-point rule of the form
    V(x,y,t+1) := function( V(x,y,t), V(x+1,y,t), V(x-1,y,t), V(x,y+1,t), V(x,y-1,t) ) .
To implement synchronous updating, store the new states in an array cnew, 
and copy the results back into the original array.

==================================================
1. BINARY MODEL
==================================================
Consider a binary model with only two states (0 and 1), representing "hot" and "cold".  For simplicity, suppose X=7 and Y=1.  
Consider a 3-point majority rule:
    V(x,y) := heaviside(V(x,y) + V(x-1,y) + V(x+1,y) - 1.5)

    0010000 --> 0000000   (one-site islands disappear)
    0011000 --> 0011000   (two-site islands are stable)
    0011010 --> 0011100   (coalescence can happen)

Lowering the threshold allows heat to spread, but the spreading is omnidirectional and irreversible:  
    V(x,y) := heaviside(V(x,y) + V(x-1,y) + V(x+1,y) - 0.5)

    0010000 --> 0111000   (a hot spot spreads in both directions)
    1101111 --> 1111111   (cold islands are swallowed up)

==================================================
2. FOUR-STATE MODEL
==================================================
Consider a four-state model.  In addition to "steady hot" and "steady cold" states, 
there are also "active hot" and "active cold" states.
A "spreading" state will decay to the "steady holding" level.
Any state that is next to a spreading state will be "infected" or "catch fire":

    STATE     DESCRIPTION      RULE
    H         Hot spreading    H --> h
    h         Hot holding      hhh --> h, Chh --> c, ...
    c         Cold holding     ccc --> c, Hcc --> h, ...
    C         Cold spreading   C --> c

This model permits hotness and coldness to spread in the same way.  
However, spreading is omnidirectional, and results in pulsing, due to "reinfection":

    ccHcccc --> cHhHccc --> HhHhHcc

==================================================
3. SIX-STATE MODEL
==================================================
The above deficiencies are rectified by using three levels of hotness and coldness each.  
This is similar to forest fire simulations, in which 3=burning, 2=burned, and
1=regrown.
The states 1 and 5 are susceptible to either "hot burn" or "cold burn" from their neighbors
(catching fire or catching a cold):

    STATE     DESCRIPTION      RULE
    7         Hot spreading    7 --> 6 
    6         Hot decaying     6 --> 5
    5         Hot holding      5 --> 5, 53 --> 32, 57 --> 76
    1         Cold spreading   3 --> 2
    2         Cold decaying    2 --> 1
    3         Cold holding     1 --> 1, 13 --> 32, 17 --> 76

This allows hot and cold pulses to propagate forwards or backwards, 
depending on where they are launched:

    73333 --> 67333 --> 56733 --> 55673 --> 55567 --> 55556 --> 55555 (heat spreading right)
    15555 --> 21555 --> 32155 --> 33215 --> 33321 --> 33332 --> 33333 (cold spreading right)

It is good that we can build wires that carry signals in either direction.
However, in a digital circuit, we need to have buffering, 
such that the input of a gate can affect the output, but the output cannot affect the input.
I don't think this model supports buffering.

==================================================
4. EIGHT-STATE MODEL
==================================================
Starting from the previous model, add two states representing a multi-input OR gate. 
The gate takes input from the north, west, and south.
The gate output is updated at every time step:
    if (n>4 || w>4 || s>4) c = 8 
    else                   c = 0

    STATE     DESCRIPTION      RULE
    8         On               8 if any input is hot (5,6,7)
    0         Off              0 otherwise

In addition, if a wire has a gate at its west, it takes the output of that gate as "spreading hot" or "spreading cold". 
In the example below, the OR gate switches on, causing its output to be held as 3
(which results in pulsing):

     5         5         5         5         5
    50111 --> 58111 --> 58311 --> 58321 --> 58313
     5         5         5         5         5

If we don't like the pulsing, we can modify the rules so that the output is "spreading" ONLY
if the output is cold and the gate is now hot, or vice versa.  Then a pulse is only generated when the gate switches.


==================================================
6. CROSSINGS
==================================================
It is difficult to implement a crossing with 'grade separation' (flyover, overpass, underpass, or subway tunnel)
under the criteria that 
(i) the number of cell states should be small and
(ii) the state of each cell should only depend on C,E,W,N,S at the previous time step.
In the actual Javascript, a new array ("subway") is used in addition to the original array ("ground").
This means we are storing an additional 3-8 bits of state representing the lava state in the subway.


==================================================
RESTORING SYMMETRY (NOT IMPLEMENTED)
==================================================
The cellular automaton described above is asymmetrical because outputs

To restore fourfold symmetry, for each gate, one could designate one or more neighbors as an OUTPUT cell. 
An output cell can only accept input from the neighboring gate.
A gate cannot accept input from this cell.  
Add two more states to the model.

Alternatively, one could use 2 additional bits to represent the direction that the gate is facing.
</pre>



</body>
</html>
